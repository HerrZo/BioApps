<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transkriptions & Translations Trainer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#f0fdfa',
                100: '#ccfbf1',
                200: '#99f6e4',
                300: '#5eead4',
                400: '#2dd4bf',
                500: '#14b8a6',
                600: '#0d9488',
                700: '#0f766e',
                800: '#115e59',
                900: '#134e4a',
              }
            }
          }
        }
      }
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Zusätzliche Animationen */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 h-screen overflow-hidden selection:bg-teal-200">
    
    <div id="root" class="h-full"></div>

    <script type="text/babel" data-presets="env,react,typescript">
        const { useState, useEffect } = React;

        // ------------------------------------------------------------------
        // TEIL 1: ICONS (aus Icons.tsx)
        // ------------------------------------------------------------------

        const IconDna = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 15c6.667-6 13.333 0 20-6"/>
                <path d="M9 22c1.798-1.998 2.518-3.995 2.807-5.993"/>
                <path d="M15 2c-1.798 1.998-2.518 3.995-2.807 5.993"/>
                <path d="m17 6-2.5-2.5"/>
                <path d="m14 8-1-1"/>
                <path d="m7 18 2.5 2.5"/>
                <path d="m3.5 14.5.5.5"/>
                <path d="m20 9 .5.5"/>
                <path d="m6.5 12.5 1 1"/>
                <path d="m16.5 10.5 1 1"/>
                <path d="m10 16 1.5 1.5"/>
            </svg>
        );

        const IconRefresh = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>
            </svg>
        );

        // ------------------------------------------------------------------
        // TEIL 2: LOGIK & HAUPTKOMPONENTE (aus App.tsx)
        // ------------------------------------------------------------------

        // --- Types & Constants ---

        type Nucleotide = 'A' | 'T' | 'G' | 'C' | 'U';
        type AminoAcid = { short: string; long: string; color: string };

        interface BiologyState {
            dnaSequence: Nucleotide[];
            rnaSequence: (Nucleotide | null)[];
            aminoAcids: (AminoAcid | null)[];
            score: number;
            message: string;
            stage: 'transcription' | 'translation';
        }

        const CODON_TABLE: Record<string, AminoAcid> = {
            'UUU': { short: 'Phe', long: 'Phenylalanin', color: 'bg-red-200' }, 'UUC': { short: 'Phe', long: 'Phenylalanin', color: 'bg-red-200' },
            'UUA': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' }, 'UUG': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' },
            'UCU': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' }, 'UCC': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' },
            'UCA': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' }, 'UCG': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' },
            'UAU': { short: 'Tyr', long: 'Tyrosin', color: 'bg-green-200' }, 'UAC': { short: 'Tyr', long: 'Tyrosin', color: 'bg-green-200' },
            'UGU': { short: 'Cys', long: 'Cystein', color: 'bg-teal-200' }, 'UGC': { short: 'Cys', long: 'Cystein', color: 'bg-teal-200' },
            'UGG': { short: 'Trp', long: 'Tryptophan', color: 'bg-blue-200' },
            'CUU': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' }, 'CUC': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' },
            'CUA': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' }, 'CUG': { short: 'Leu', long: 'Leucin', color: 'bg-orange-200' },
            'CCU': { short: 'Pro', long: 'Prolin', color: 'bg-indigo-200' }, 'CCC': { short: 'Pro', long: 'Prolin', color: 'bg-indigo-200' },
            'CCA': { short: 'Pro', long: 'Prolin', color: 'bg-indigo-200' }, 'CCG': { short: 'Pro', long: 'Prolin', color: 'bg-indigo-200' },
            'CAU': { short: 'His', long: 'Histidin', color: 'bg-purple-200' }, 'CAC': { short: 'His', long: 'Histidin', color: 'bg-purple-200' },
            'CAA': { short: 'Gln', long: 'Glutamin', color: 'bg-pink-200' }, 'CAG': { short: 'Gln', long: 'Glutamin', color: 'bg-pink-200' },
            'CGU': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' }, 'CGC': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' },
            'CGA': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' }, 'CGG': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' },
            'AUU': { short: 'Ile', long: 'Isoleucin', color: 'bg-lime-200' }, 'AUC': { short: 'Ile', long: 'Isoleucin', color: 'bg-lime-200' },
            'AUA': { short: 'Ile', long: 'Isoleucin', color: 'bg-lime-200' },
            'AUG': { short: 'Met', long: 'Methionin (Start)', color: 'bg-emerald-300' },
            'ACU': { short: 'Thr', long: 'Threonin', color: 'bg-cyan-200' }, 'ACC': { short: 'Thr', long: 'Threonin', color: 'bg-cyan-200' },
            'ACA': { short: 'Thr', long: 'Threonin', color: 'bg-cyan-200' }, 'ACG': { short: 'Thr', long: 'Threonin', color: 'bg-cyan-200' },
            'AAU': { short: 'Asn', long: 'Asparagin', color: 'bg-sky-200' }, 'AAC': { short: 'Asn', long: 'Asparagin', color: 'bg-sky-200' },
            'AAA': { short: 'Lys', long: 'Lysin', color: 'bg-violet-200' }, 'AAG': { short: 'Lys', long: 'Lysin', color: 'bg-violet-200' },
            'AGU': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' }, 'AGC': { short: 'Ser', long: 'Serin', color: 'bg-yellow-200' },
            'AGA': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' }, 'AGG': { short: 'Arg', long: 'Arginin', color: 'bg-rose-200' },
            'GUU': { short: 'Val', long: 'Valin', color: 'bg-amber-200' }, 'GUC': { short: 'Val', long: 'Valin', color: 'bg-amber-200' },
            'GUA': { short: 'Val', long: 'Valin', color: 'bg-amber-200' }, 'GUG': { short: 'Val', long: 'Valin', color: 'bg-amber-200' },
            'GCU': { short: 'Ala', long: 'Alanin', color: 'bg-fuchsia-200' }, 'GCC': { short: 'Ala', long: 'Alanin', color: 'bg-fuchsia-200' },
            'GCA': { short: 'Ala', long: 'Alanin', color: 'bg-fuchsia-200' }, 'GCG': { short: 'Ala', long: 'Alanin', color: 'bg-fuchsia-200' },
            'GAU': { short: 'Asp', long: 'Asparaginsäure', color: 'bg-stone-200' }, 'GAC': { short: 'Asp', long: 'Asparaginsäure', color: 'bg-stone-200' },
            'GAA': { short: 'Glu', long: 'Glutaminsäure', color: 'bg-gray-200' }, 'GAG': { short: 'Glu', long: 'Glutaminsäure', color: 'bg-gray-200' },
            'GGU': { short: 'Gly', long: 'Glycin', color: 'bg-slate-200' }, 'GGC': { short: 'Gly', long: 'Glycin', color: 'bg-slate-200' },
            'GGA': { short: 'Gly', long: 'Glycin', color: 'bg-slate-200' }, 'GGG': { short: 'Gly', long: 'Glycin', color: 'bg-slate-200' },
            'UAA': { short: 'STOP', long: 'Stop-Codon', color: 'bg-red-400' },
            'UAG': { short: 'STOP', long: 'Stop-Codon', color: 'bg-red-400' },
            'UGA': { short: 'STOP', long: 'Stop-Codon', color: 'bg-red-400' },
        };

        // --- SVG Codon Sun Component ---

        const CodonSun = () => {
            const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {
                const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
                return {
                x: centerX + (radius * Math.cos(angleInRadians)),
                y: centerY + (radius * Math.sin(angleInRadians))
                };
            };

            const createSector = (index: number, total: number, innerR: number, outerR: number, label: string, fill: string) => {
                const startAngle = (index * 360) / total;
                const endAngle = ((index + 1) * 360) / total;
                
                const start = polarToCartesian(200, 200, outerR, endAngle);
                const end = polarToCartesian(200, 200, outerR, startAngle);
                const innerStart = polarToCartesian(200, 200, innerR, endAngle);
                const innerEnd = polarToCartesian(200, 200, innerR, startAngle);

                const path = [
                "M", start.x, start.y,
                "A", outerR, outerR, 0, 0, 0, end.x, end.y,
                "L", innerEnd.x, innerEnd.y,
                "A", innerR, innerR, 0, 0, 1, innerStart.x, innerStart.y,
                "Z"
                ].join(" ");

                const midAngle = startAngle + (endAngle - startAngle) / 2;
                const textRadius = innerR + (outerR - innerR) / 2;
                const textPos = polarToCartesian(200, 200, textRadius, midAngle);

                const rotateText = (innerR > 130) ? `rotate(${midAngle > 180 ? midAngle + 90 : midAngle - 90}, ${textPos.x}, ${textPos.y})` : '';

                return (
                <g key={`${innerR}-${index}`}>
                    <path d={path} fill={fill} stroke="white" strokeWidth="1" />
                    <text 
                        x={textPos.x} 
                        y={textPos.y} 
                        fill={innerR > 100 ? "#333" : "white"}
                        fontSize={innerR > 140 ? "8" : "12"}
                        fontWeight="bold"
                        textAnchor="middle" 
                        alignmentBaseline="middle"
                        transform={rotateText}
                    >
                    {label}
                    </text>
                </g>
                );
            };

            const bases = ['G', 'A', 'C', 'U']; 
            const colors = {'G': '#f59e0b', 'A': '#ef4444', 'C': '#3b82f6', 'U': '#10b981'};
            
            const rings = [];

            // Ring 1 (Inner)
            bases.forEach((base, i) => {
                rings.push(createSector(i, 4, 30, 80, base, colors[base as keyof typeof colors]));
            });

            // Ring 2
            const ring2Bases = [];
            for(let i=0; i<4; i++) {
                bases.forEach(b => ring2Bases.push(b));
            }
            ring2Bases.forEach((base, i) => {
                rings.push(createSector(i, 16, 80, 130, base, colors[base as keyof typeof colors]));
            });

            // Ring 3 (Outer Bases)
            const ring3Bases = [];
            for(let i=0; i<16; i++) {
                bases.forEach(b => ring3Bases.push(b));
            }
            ring3Bases.forEach((base, i) => {
                rings.push(createSector(i, 64, 130, 160, base, "#f3f4f6"));
            });

            // Ring 4: Amino Acids
            ring3Bases.forEach((_, i) => {
                const b1 = bases[Math.floor(i / 16)];
                const b2 = bases[Math.floor((i % 16) / 4)];
                const b3 = bases[i % 4];
                const codon = b1 + b2 + b3;
                const amino = CODON_TABLE[codon]?.short || '';
                
                rings.push(createSector(i, 64, 160, 195, amino, "white"));
            });

            return (
                <div className="flex flex-col items-center">
                    <h4 className="text-sm font-bold text-gray-500 mb-2">Codesonne (Innen nach Außen: 1. → 2. → 3. Base)</h4>
                    <svg width="400" height="400" viewBox="0 0 400 400" className="max-w-full h-auto drop-shadow-md">
                        <circle cx="200" cy="200" r="198" fill="white" stroke="#e5e7eb" strokeWidth="1"/>
                        {rings}
                        <circle cx="200" cy="200" r="30" fill="white" />
                        <text x="200" y="200" textAnchor="middle" alignmentBaseline="middle" fontSize="10" fontWeight="bold" fill="#9ca3af">Start</text>
                    </svg>
                </div>
            );
        };

        // --- Main Component ---

        const ProteinSynthesis = () => {
            const [dna, setDna] = useState<Nucleotide[]>([]);
            const [mrna, setMrna] = useState<(Nucleotide | null)[]>([]);
            const [aminoChain, setAminoChain] = useState<(AminoAcid | null)[]>([]);
            const [currentIdx, setCurrentIdx] = useState(0); 
            const [stage, setStage] = useState<'transcription' | 'translation'>('transcription');
            const [feedback, setFeedback] = useState<string>('Beginne mit der Transkription! Wähle die passende Base.');
            const [isCorrect, setIsCorrect] = useState<boolean | null>(null);
            const [showSun, setShowSun] = useState(false);

            // Start new game
            const initGame = () => {
                const bases: Nucleotide[] = ['A', 'T', 'G', 'C'];
                const start: Nucleotide[] = ['T', 'A', 'C'];
                const chunks = 3; 
                let sequence: Nucleotide[] = [...start];
                
                for (let i = 0; i < chunks * 3; i++) {
                sequence.push(bases[Math.floor(Math.random() * bases.length)] as Nucleotide);
                }
                sequence.push('A', 'C', 'T'); // Stop codon TGA -> RNA UGA

                setDna(sequence);
                setMrna(new Array(sequence.length).fill(null));
                setAminoChain(new Array(sequence.length / 3).fill(null));
                setStage('transcription');
                setCurrentIdx(0);
                setFeedback('Transkribiere die DNA in mRNA. Welche Base passt zu ' + sequence[0] + '?');
                setIsCorrect(null);
                setShowSun(false);
            };

            useEffect(() => {
                initGame();
            }, []);

            // Handle Base Input
            const handleBaseClick = (base: Nucleotide) => {
                if (stage !== 'transcription') return;

                const templateBase = dna[currentIdx];
                let correctMatch = '';
                
                switch(templateBase) {
                case 'A': correctMatch = 'U'; break;
                case 'T': correctMatch = 'A'; break;
                case 'G': correctMatch = 'C'; break;
                case 'C': correctMatch = 'G'; break;
                }

                if (base === correctMatch) {
                const newMrna = [...mrna];
                newMrna[currentIdx] = base;
                setMrna(newMrna);
                setIsCorrect(true);
